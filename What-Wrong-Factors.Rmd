---
title: "What Can Go Wrong With Factors in R"
subtitle: "Series: What Can Go Wrong in R"
author: "StatistikinDD"
date: "Presentation Created: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    chakra: libs/remark-latest.min.js
    lib_dir: libs
    css: ["xaringan-themer.css", "libs/_css/my_css.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
      ratio: 16:9
---

```{r setup, include = FALSE}

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE, comment = "")
xaringanthemer::style_mono_accent(title_slide_background_color = "#EDF4FB",
                                  title_slide_text_color = "#000000",
                                  base_font_size = "18px")
Sys.setenv(LANG = "en")
library(knitr)
# options(width = 45)
# library(printr)
```

# What Can Go Wrong With Factors in R

* ### Invalid factor levels

--

* ### Recoding factors wrongly

--

* ### Converting factors to numeric

--

```{r}
include_graphics("libs/_Images/invalid-factor-level.png")
```

---

# Invalid factor levels

.pull-left[
```{r}
f <- factor(letters[1:4])
f

f[5] <- "e"

```
]

.pull-right[
### Better

* define new factor level explicitly OR
* merge, rbind, c(), dplyr::bind_rows, dplyr::left_join() etc. all deal with this

]

---

# Recoding Factors Wrongly

.pull-left[
```{r, echo = TRUE}
winners <- c("Susan", "Michael", "Susan", "Susan", "Susan")
str(winners)
winners

winners <- as.factor(winners)
winners
```

--

```{r, echo = TRUE}
levels(winners) <- c("Suze", "Mike")
winners

```
]

.pull-right[
### Better

* Take alphabetic order into account
* Use explicit recoding, e. g. via dplyr

]
---

# Converting Factors to Numeric

```{r, echo = TRUE}
f <- factor(6:10)
f
as.numeric(f) #<<
```

--

### Better

```{r}
f |>
  as.character() |>  #<<
  as.numeric()

# Same as
as.numeric(as.character(f))

# Recommended in R's documentation
# See ?factor
as.numeric(levels(f))[f] #<<
```


---

class: center, middle

# Thanks!

### Youtube: StatistikinDD

### Twitter: @StatistikinDD

### github: fjodor

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](https://yihui.org/knitr), and [R Markdown](https://rmarkdown.rstudio.com).

Thanks to **Yihui Xie** for *{knitr}* and *{xaringan}* and **Garrick Aden-Buie** for *{xaringanthemer}*.
